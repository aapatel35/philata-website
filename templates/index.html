{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block extra_css %}
<style>
    /* Hero Section - Premium Consulting Style */
    .hero {
        padding: 80px 0 60px;
        position: relative;
    }

    .hero-eyebrow {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        font-weight: 600;
        color: var(--gold);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 20px;
    }

    .hero-eyebrow::before {
        content: '';
        width: 24px;
        height: 1px;
        background: var(--gold);
    }

    .hero-title {
        font-family: 'Instrument Serif', Georgia, serif;
        font-size: 3.5rem;
        font-weight: 400;
        color: var(--text-primary);
        line-height: 1.1;
        letter-spacing: -0.02em;
        margin-bottom: 24px;
        max-width: 700px;
    }

    .hero-title em {
        font-style: italic;
        color: var(--gold);
    }

    .hero-description {
        font-size: 18px;
        color: var(--text-tertiary);
        line-height: 1.7;
        max-width: 540px;
        margin-bottom: 40px;
    }

    .hero-actions {
        display: flex;
        gap: 16px;
        align-items: center;
    }

    .hero-stats {
        display: flex;
        gap: 48px;
        margin-top: 64px;
        padding-top: 48px;
        border-top: 1px solid var(--border-subtle);
    }

    .hero-stat {
        text-align: left;
    }

    .hero-stat-value {
        font-size: 2.5rem;
        font-weight: 600;
        color: var(--text-primary);
        letter-spacing: -0.02em;
        line-height: 1;
        margin-bottom: 4px;
    }

    .hero-stat-label {
        font-size: 13px;
        color: var(--text-tertiary);
        font-weight: 500;
    }

    /* Featured Section */
    .featured-section {
        margin-bottom: 64px;
    }

    .featured-grid {
        display: grid;
        grid-template-columns: 1.5fr 1fr;
        gap: 24px;
    }

    .featured-main {
        background: var(--obsidian);
        border-radius: 16px;
        overflow: hidden;
        position: relative;
        min-height: 400px;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        padding: 40px;
        text-decoration: none;
        transition: transform var(--duration-normal) var(--ease-out);
    }

    .featured-main:hover {
        transform: scale(1.01);
    }

    .featured-main-bg {
        position: absolute;
        inset: 0;
        background-size: cover;
        background-position: center;
        opacity: 0.4;
    }

    .featured-main-content {
        position: relative;
        z-index: 1;
    }

    .featured-main-badge {
        display: inline-block;
        font-size: 11px;
        font-weight: 600;
        color: var(--gold);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        margin-bottom: 16px;
    }

    .featured-main-title {
        font-family: 'Instrument Serif', Georgia, serif;
        font-size: 1.75rem;
        font-weight: 400;
        color: var(--snow);
        line-height: 1.3;
        margin-bottom: 12px;
    }

    .featured-main-excerpt {
        font-size: 15px;
        color: var(--pearl);
        line-height: 1.6;
        max-width: 480px;
    }

    .featured-sidebar {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .featured-item {
        flex: 1;
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        padding: 24px;
        text-decoration: none;
        transition: all var(--duration-normal) var(--ease-out);
        display: flex;
        flex-direction: column;
    }

    .featured-item:hover {
        border-color: transparent;
        box-shadow: var(--shadow-md);
        transform: translateX(4px);
    }

    .featured-item-category {
        font-size: 11px;
        font-weight: 600;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin-bottom: 12px;
    }

    .featured-item-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        line-height: 1.4;
        margin-bottom: 8px;
        flex: 1;
    }

    .featured-item:hover .featured-item-title {
        color: var(--gold);
    }

    .featured-item-meta {
        font-size: 12px;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 4px;
    }

    /* Services Grid */
    .services-section {
        margin-bottom: 64px;
    }

    .services-header {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        margin-bottom: 32px;
    }

    .services-header-text h2 {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .services-header-text p {
        font-size: 15px;
        color: var(--text-tertiary);
    }

    .services-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
    }

    .service-card {
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        padding: 32px 28px;
        text-decoration: none;
        transition: all var(--duration-normal) var(--ease-out);
        position: relative;
    }

    .service-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--obsidian);
        opacity: 0;
        transition: opacity var(--duration-fast);
        border-radius: 12px 12px 0 0;
    }

    .service-card:hover {
        border-color: transparent;
        box-shadow: var(--shadow-lg);
        transform: translateY(-4px);
    }

    .service-card:hover::before {
        opacity: 1;
    }

    .service-icon {
        width: 48px;
        height: 48px;
        background: var(--bg-secondary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: var(--text-secondary);
        margin-bottom: 20px;
        transition: all var(--duration-fast);
    }

    .service-card:hover .service-icon {
        background: var(--obsidian);
        color: var(--snow);
    }

    .service-title {
        font-size: 17px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .service-desc {
        font-size: 14px;
        color: var(--text-tertiary);
        line-height: 1.6;
    }

    /* Insights Section */
    .insights-section {
        margin-bottom: 64px;
    }

    .insights-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 32px;
    }

    .insights-header h2 {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .insights-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
    }

    /* Provinces Section */
    .provinces-section {
        background: var(--bg-secondary);
        margin: 0 -40px 64px;
        padding: 64px 40px;
    }

    .provinces-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .provinces-header h2 {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .provinces-header p {
        font-size: 15px;
        color: var(--text-tertiary);
    }

    .provinces-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 16px;
        max-width: 1000px;
        margin: 0 auto;
    }

    .province-card {
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        padding: 20px 16px;
        text-align: center;
        text-decoration: none;
        transition: all var(--duration-normal) var(--ease-out);
    }

    .province-card:hover {
        border-color: transparent;
        box-shadow: var(--shadow-md);
        transform: translateY(-4px);
    }

    .province-flag {
        width: 48px;
        height: 32px;
        background: var(--bg-secondary);
        border-radius: 4px;
        margin: 0 auto 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        overflow: hidden;
    }

    .province-flag img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .province-name {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
    }

    .province-abbr {
        font-size: 11px;
        color: var(--text-muted);
    }

    /* CTA Section */
    .cta-section {
        background: var(--obsidian);
        border-radius: 16px;
        padding: 64px;
        text-align: center;
        margin-bottom: 40px;
        position: relative;
        overflow: hidden;
    }

    .cta-section::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -25%;
        width: 150%;
        height: 200%;
        background: radial-gradient(ellipse at center, rgba(184, 134, 11, 0.1) 0%, transparent 60%);
        pointer-events: none;
    }

    .cta-content {
        position: relative;
        z-index: 1;
    }

    .cta-title {
        font-family: 'Instrument Serif', Georgia, serif;
        font-size: 2rem;
        font-weight: 400;
        color: var(--snow);
        margin-bottom: 16px;
    }

    .cta-text {
        font-size: 16px;
        color: var(--pearl);
        margin-bottom: 32px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }

    .cta-actions {
        display: flex;
        gap: 16px;
        justify-content: center;
    }

    /* Responsive */
    @media (max-width: 1200px) {
        .services-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        .provinces-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    @media (max-width: 991px) {
        .hero-title {
            font-size: 2.5rem;
        }
        .featured-grid {
            grid-template-columns: 1fr;
        }
        .featured-main {
            min-height: 300px;
        }
        .featured-sidebar {
            flex-direction: row;
        }
        .insights-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        .provinces-section {
            margin: 0 -24px 64px;
            padding: 48px 24px;
        }
    }

    @media (max-width: 768px) {
        .hero {
            padding: 40px 0;
        }
        .hero-title {
            font-size: 2rem;
        }
        .hero-stats {
            flex-wrap: wrap;
            gap: 32px;
        }
        .hero-stat {
            min-width: 120px;
        }
        .services-grid,
        .insights-grid {
            grid-template-columns: 1fr;
        }
        .featured-sidebar {
            flex-direction: column;
        }
        .provinces-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        .cta-section {
            padding: 40px 24px;
        }
        .cta-title {
            font-size: 1.5rem;
        }
    }

    @media (max-width: 576px) {
        .hero-stats {
            gap: 24px;
        }
        .hero-stat-value {
            font-size: 2rem;
        }
        .provinces-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        .cta-actions {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero" data-animate>
    <div class="hero-eyebrow">Canadian Immigration Intelligence</div>
    <h1 class="hero-title">Navigate your path to <em>Canada</em> with clarity</h1>
    <p class="hero-description">
        Expert analysis, real-time updates, and comprehensive resources for Express Entry,
        Provincial Programs, and all Canadian immigration pathways.
    </p>
    <div class="hero-actions">
        <a href="/articles" class="btn btn-primary btn-lg">
            Explore Insights
            <i class="bi bi-arrow-right"></i>
        </a>
        <a href="/tools/crs-calculator" class="btn btn-secondary btn-lg">
            CRS Calculator
        </a>
    </div>
    <div class="hero-stats">
        <div class="hero-stat">
            <div class="hero-stat-value" data-counter data-target="500">0</div>
            <div class="hero-stat-label">Articles Published</div>
        </div>
        <div class="hero-stat">
            <div class="hero-stat-value" data-counter data-target="13">0</div>
            <div class="hero-stat-label">Provinces Covered</div>
        </div>
        <div class="hero-stat">
            <div class="hero-stat-value" data-counter data-target="24" data-suffix="/7">0</div>
            <div class="hero-stat-label">News Monitoring</div>
        </div>
        <div class="hero-stat">
            <div class="hero-stat-value" data-counter data-target="100" data-suffix="%">0</div>
            <div class="hero-stat-label">Official Sources</div>
        </div>
    </div>
</section>

<div class="divider"></div>

<!-- Featured Articles -->
<section class="featured-section" data-animate>
    <div class="featured-grid">
        <a href="/articles" class="featured-main" id="featured-main">
            <div class="featured-main-bg" style="background-image: url('https://images.unsplash.com/photo-1503614472-8c93d56e92ce?w=800&q=80');"></div>
            <div class="featured-main-content">
                <span class="featured-main-badge">Featured</span>
                <h2 class="featured-main-title" id="featured-title">Latest Immigration Insights</h2>
                <p class="featured-main-excerpt" id="featured-excerpt">Stay informed with breaking news, policy updates, and expert analysis on Canadian immigration.</p>
            </div>
        </a>
        <div class="featured-sidebar" id="featured-sidebar">
            <div class="featured-item">
                <span class="featured-item-category">Loading...</span>
                <h3 class="featured-item-title">Fetching latest articles...</h3>
                <span class="featured-item-meta"><i class="bi bi-clock"></i> --</span>
            </div>
            <div class="featured-item">
                <span class="featured-item-category">Loading...</span>
                <h3 class="featured-item-title">Please wait...</h3>
                <span class="featured-item-meta"><i class="bi bi-clock"></i> --</span>
            </div>
        </div>
    </div>
</section>

<!-- Services/Programs -->
<section class="services-section" data-animate>
    <div class="services-header">
        <div class="services-header-text">
            <h2>Immigration Pathways</h2>
            <p>Comprehensive guides for every Canadian immigration program</p>
        </div>
        <a href="/browse" class="section-link">View all programs <i class="bi bi-arrow-right"></i></a>
    </div>
    <div class="services-grid">
        <a href="/browse/express-entry" class="service-card">
            <div class="service-icon"><i class="bi bi-lightning"></i></div>
            <h3 class="service-title">Express Entry</h3>
            <p class="service-desc">Fast-track skilled worker immigration through FSW, CEC, and FST programs.</p>
        </a>
        <a href="/browse/pnp" class="service-card">
            <div class="service-icon"><i class="bi bi-geo-alt"></i></div>
            <h3 class="service-title">Provincial Programs</h3>
            <p class="service-desc">Province-specific nomination programs with varied eligibility criteria.</p>
        </a>
        <a href="/browse/work-permits" class="service-card">
            <div class="service-icon"><i class="bi bi-briefcase"></i></div>
            <h3 class="service-title">Work Permits</h3>
            <p class="service-desc">LMIA, open work permits, PGWP, and International Experience Canada.</p>
        </a>
        <a href="/browse/study" class="service-card">
            <div class="service-icon"><i class="bi bi-mortarboard"></i></div>
            <h3 class="service-title">Study Permits</h3>
            <p class="service-desc">Student visa requirements and post-graduation pathways to PR.</p>
        </a>
        <a href="/browse/family" class="service-card">
            <div class="service-icon"><i class="bi bi-people"></i></div>
            <h3 class="service-title">Family Sponsorship</h3>
            <p class="service-desc">Sponsor spouse, common-law partner, children, or parents.</p>
        </a>
        <a href="/tools/crs-calculator" class="service-card">
            <div class="service-icon"><i class="bi bi-calculator"></i></div>
            <h3 class="service-title">CRS Calculator</h3>
            <p class="service-desc">Calculate your Comprehensive Ranking System score instantly.</p>
        </a>
    </div>
</section>

<!-- Latest Insights -->
<section class="insights-section" data-animate>
    <div class="insights-header">
        <h2>Latest Insights</h2>
        <a href="/articles" class="section-link">View all <i class="bi bi-arrow-right"></i></a>
    </div>
    <div class="insights-grid" id="insights-grid">
        <!-- Loaded via JS -->
    </div>
</section>

<!-- Provinces -->
<section class="provinces-section" data-animate>
    <div class="provinces-header">
        <h2>Provincial Nominee Programs</h2>
        <p>Each province has unique immigration streams tailored to regional needs</p>
    </div>
    <div class="provinces-grid">
        <a href="/province/ontario" class="province-card">
            <div class="province-flag"><span>ON</span></div>
            <div class="province-name">Ontario</div>
            <div class="province-abbr">OINP</div>
        </a>
        <a href="/province/british-columbia" class="province-card">
            <div class="province-flag"><span>BC</span></div>
            <div class="province-name">British Columbia</div>
            <div class="province-abbr">BC PNP</div>
        </a>
        <a href="/province/alberta" class="province-card">
            <div class="province-flag"><span>AB</span></div>
            <div class="province-name">Alberta</div>
            <div class="province-abbr">AAIP</div>
        </a>
        <a href="/province/manitoba" class="province-card">
            <div class="province-flag"><span>MB</span></div>
            <div class="province-name">Manitoba</div>
            <div class="province-abbr">MPNP</div>
        </a>
        <a href="/province/saskatchewan" class="province-card">
            <div class="province-flag"><span>SK</span></div>
            <div class="province-name">Saskatchewan</div>
            <div class="province-abbr">SINP</div>
        </a>
        <a href="/province/nova-scotia" class="province-card">
            <div class="province-flag"><span>NS</span></div>
            <div class="province-name">Nova Scotia</div>
            <div class="province-abbr">NSNP</div>
        </a>
    </div>
</section>

<!-- CTA -->
<section class="cta-section" data-animate>
    <div class="cta-content">
        <h2 class="cta-title">Ready to start your journey?</h2>
        <p class="cta-text">Use our CRS Calculator to assess your eligibility for Express Entry, or explore our comprehensive guides.</p>
        <div class="cta-actions">
            <a href="/tools/crs-calculator" class="btn btn-gold btn-lg">
                <i class="bi bi-calculator"></i>
                Calculate CRS Score
            </a>
            <a href="/guides" class="btn btn-secondary btn-lg" style="border-color: var(--silver); color: var(--snow);">
                Browse Guides
            </a>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Load featured articles
    fetch('/api/results')
        .then(r => r.json())
        .then(data => {
            const articles = (data.results || [])
                .filter(a => a.full_article && a.full_article.length > 200)
                .slice(0, 5);

            if (articles.length > 0) {
                // Update featured main
                const main = articles[0];
                const mainSlug = main.slug || main.title.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/[\s_]+/g, '-').substring(0, 80);
                document.getElementById('featured-main').href = '/articles/' + mainSlug;
                document.getElementById('featured-title').textContent = main.title;
                document.getElementById('featured-excerpt').textContent = main.summary || main.title;
                if (main.image_url) {
                    document.querySelector('.featured-main-bg').style.backgroundImage = `url('${main.image_url}')`;
                }

                // Update sidebar
                const sidebarArticles = articles.slice(1, 3);
                const sidebar = document.getElementById('featured-sidebar');
                sidebar.innerHTML = sidebarArticles.map(article => {
                    const slug = article.slug || article.title.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/[\s_]+/g, '-').substring(0, 80);
                    const category = (article.category || 'news').replace(/_/g, ' ');
                    const readTime = Math.max(1, Math.floor((article.full_article || '').split(' ').length / 200));
                    return `
                        <a href="/articles/${slug}" class="featured-item">
                            <span class="featured-item-category">${category}</span>
                            <h3 class="featured-item-title">${article.title}</h3>
                            <span class="featured-item-meta"><i class="bi bi-clock"></i> ${readTime} min read</span>
                        </a>
                    `;
                }).join('');

                // Update insights grid
                const insightsArticles = articles.slice(0, 3);
                const insightsGrid = document.getElementById('insights-grid');
                insightsGrid.innerHTML = insightsArticles.map(article => {
                    const slug = article.slug || article.title.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/[\s_]+/g, '-').substring(0, 80);
                    const category = (article.category || 'news').replace(/_/g, ' ');
                    const readTime = Math.max(1, Math.floor((article.full_article || '').split(' ').length / 200));
                    const imageUrl = article.image_url || 'https://images.unsplash.com/photo-1503614472-8c93d56e92ce?w=400&q=70';
                    const badgeClass = 'badge-' + (article.category || 'news').replace(/_/g, '-');
                    return `
                        <a href="/articles/${slug}" class="article-card">
                            <div class="article-card-image" style="background-image: url('${imageUrl}');">
                                <span class="article-card-badge badge ${badgeClass}">${category}</span>
                            </div>
                            <div class="article-card-content">
                                <h3 class="article-card-title">${article.title}</h3>
                                <p class="article-card-excerpt">${article.summary || ''}</p>
                                <div class="article-card-meta">
                                    <span><i class="bi bi-clock"></i> ${readTime} min</span>
                                    <span><i class="bi bi-eye"></i> ${article.source || 'IRCC'}</span>
                                </div>
                            </div>
                        </a>
                    `;
                }).join('');
            } else {
                // No articles - show placeholder
                document.getElementById('featured-sidebar').innerHTML = `
                    <div class="featured-item">
                        <span class="featured-item-category">Coming Soon</span>
                        <h3 class="featured-item-title">Fresh content arriving shortly</h3>
                        <span class="featured-item-meta">Check back soon</span>
                    </div>
                `;
                document.getElementById('insights-grid').innerHTML = `
                    <div class="article-card" style="grid-column: span 3; text-align: center; padding: 48px;">
                        <p style="color: var(--text-tertiary);">No articles yet. New content will appear here automatically.</p>
                    </div>
                `;
            }
        })
        .catch(e => {
            console.error('Error loading articles:', e);
            document.getElementById('insights-grid').innerHTML = `
                <div class="article-card" style="grid-column: span 3; text-align: center; padding: 48px;">
                    <p style="color: var(--text-tertiary);">Content loading... Check back soon.</p>
                </div>
            `;
        });

    // Fetch real stats
    fetch('/api/stats')
        .then(r => r.json())
        .then(stats => {
            const total = Object.values(stats.by_track || {}).reduce((a, b) => a + b, 0);
            if (total > 0) {
                const counter = document.querySelector('[data-target="500"]');
                if (counter) counter.setAttribute('data-target', total);
            }
        })
        .catch(() => {});
</script>
{% endblock %}
