{% extends "base.html" %}

{% block title %}Immigration Guides{% endblock %}

{% block extra_css %}
<style>
    /* Breadcrumb */
    .breadcrumb-nav {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-size: 13px;
        color: #4B5563; /* gray-500 */
    }

    .breadcrumb-nav a {
        color: #4B5563; /* gray-500 */
        text-decoration: none;
    }

    .breadcrumb-nav a:hover {
        color: var(--primary);
    }

    /* Category Card */
    .cat-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 24px;
        height: 100%;
        position: relative;
        overflow: hidden;
        text-decoration: none;
        display: block;
        transition: all 0.2s ease;
    }

    .cat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--cat-color, var(--primary));
        opacity: 0;
        transition: opacity 0.2s ease;
    }

    .cat-card:hover {
        box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        border-color: var(--cat-color, var(--primary));
    }

    .cat-card:hover::before {
        opacity: 1;
    }

    .cat-icon {
        width: 52px;
        height: 52px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        margin-bottom: 16px;
    }

    .cat-title {
        font-size: 17px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 8px;
    }

    .cat-desc {
        color: #4B5563; /* gray-500 - visible description */
        font-size: 13px;
        margin-bottom: 16px;
        line-height: 1.6;
    }

    .cat-count {
        font-size: 12px;
        color: var(--text-light);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .cat-arrow {
        position: absolute;
        bottom: 24px;
        right: 24px;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--bg);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #4B5563; /* gray-500 */
        transition: all 0.2s ease;
    }

    .cat-card:hover .cat-arrow {
        background: var(--accent);
        color: white;
    }

    /* Province Grid */
    .province-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 16px;
    }

    .province-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        text-decoration: none;
        display: block;
        transition: all 0.2s ease;
    }

    .province-card:hover {
        box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        border-color: var(--primary);
    }

    .province-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
    }

    .province-flag {
        width: 44px;
        height: 44px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 700;
        color: white;
    }

    .province-name {
        font-size: 15px;
        font-weight: 600;
        color: var(--text);
    }

    .province-code {
        font-size: 12px;
        color: #4B5563; /* gray-500 */
    }

    .province-stats {
        display: flex;
        gap: 16px;
        font-size: 12px;
        color: #4B5563; /* gray-500 */
    }

    .province-stats strong {
        color: var(--text);
    }

    /* Featured Cards */
    .featured-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        text-decoration: none;
        display: block;
        height: 100%;
        transition: all 0.2s ease;
    }

    .featured-card:hover {
        box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }

    .featured-image {
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
    }

    .featured-content {
        padding: 20px;
    }

    .featured-badge {
        display: inline-block;
        background: var(--bg);
        color: #4B5563; /* gray-500 */
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 8px;
    }

    .featured-title {
        font-size: 15px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 6px;
    }

    .featured-desc {
        font-size: 13px;
        color: #4B5563; /* gray-500 */
        margin: 0;
    }

    /* Guide Card */
    .guide-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        text-decoration: none;
        display: block;
        height: 100%;
        transition: all 0.2s ease;
    }

    .guide-card:hover {
        box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        border-color: var(--primary);
    }

    .guide-image {
        height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
    }

    .guide-content {
        padding: 16px;
    }

    .guide-difficulty {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 8px;
    }

    .guide-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 4px;
    }

    .guide-desc {
        font-size: 12px;
        color: #4B5563; /* gray-500 */
        margin-bottom: 8px;
    }

    .guide-meta {
        font-size: 11px;
        color: var(--text-light);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
    }

    .empty-state i {
        font-size: 48px;
        color: var(--text-light);
        margin-bottom: 16px;
    }

    /* CTA Card */
    .cta-card {
        background: linear-gradient(135deg, #1E3A5F 0%, #0F172A 100%); /* Dark blue gradient */
        border-radius: 16px;
        padding: 40px;
        text-align: center;
        color: #FFFFFF;
    }

    .cta-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 12px;
        color: #FFFFFF;
    }

    .cta-desc {
        max-width: 500px;
        margin: 0 auto 24px;
        font-size: 14px;
        color: #D1D5DB; /* gray-300 - visible on dark */
    }

    .cta-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .cta-card .btn-white {
        background: #FFFFFF;
        color: #111827; /* dark text on white button */
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: all 0.2s ease;
    }

    .cta-card .btn-white:hover {
        background: #F3F4F6;
        transform: translateY(-2px);
    }

    .cta-card .btn-outline-white {
        background: transparent;
        color: #FFFFFF;
        border: 2px solid rgba(255, 255, 255, 0.5);
        padding: 10px 22px;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: all 0.2s ease;
    }

    .cta-card .btn-outline-white:hover {
        background: #FFFFFF;
        color: #111827;
        border-color: #FFFFFF;
    }

    /* Search Box (for guides page) */
    .guide-search {
        max-width: 400px;
        position: relative;
        margin-bottom: 24px;
    }

    .guide-search input {
        width: 100%;
        padding: 12px 16px 12px 44px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 14px;
    }

    .guide-search input:focus {
        outline: none;
        border-color: var(--primary);
    }

    .guide-search i {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #4B5563; /* gray-500 */
    }

    @media (max-width: 576px) {
        .province-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
{% if selected_category %}
<!-- Category Detail View -->
<nav class="breadcrumb-nav">
    <a href="/guides">Guides</a>
    <i class="bi bi-chevron-right" style="font-size: 10px;"></i>
    <span style="color: {{ selected_category.color }};">{{ selected_category.title }}</span>
</nav>

<div class="page-header">
    <h1 class="page-title">{{ selected_category.title }} Guides</h1>
    <p class="page-subtitle">{{ selected_category.description }}</p>
</div>

<!-- Guides List -->
{% if selected_category.guides %}
<div class="row g-4">
    {% for guide in selected_category.guides %}
    <div class="col-md-6 col-lg-4">
        <a href="/guides/{{ selected_category.id }}/{{ guide.id }}" class="guide-card">
            <div class="guide-image" style="background: linear-gradient(135deg, {{ selected_category.color }}, {{ selected_category.color }}99);">
                {{ guide.icon }}
            </div>
            <div class="guide-content">
                {% if guide.difficulty %}
                <span class="guide-difficulty" style="background: {{ selected_category.color }}22; color: {{ selected_category.color }};">{{ guide.difficulty }}</span>
                {% endif %}
                <h4 class="guide-title">{{ guide.title }}</h4>
                <p class="guide-desc">{{ guide.subtitle or guide.overview[:80] ~ '...' if guide.overview else '' }}</p>
                {% if guide.reading_time %}
                <p class="guide-meta"><i class="bi bi-clock me-1"></i>{{ guide.reading_time }}</p>
                {% endif %}
            </div>
        </a>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <i class="bi bi-inbox"></i>
    <h3>No guides available yet</h3>
    <p class="text-muted">We're working on adding guides for this category.</p>
    <a href="/guides" class="btn btn-primary mt-3"><i class="bi bi-arrow-left me-2"></i>Back to All Guides</a>
</div>
{% endif %}

<!-- Other Categories -->
<div class="section" style="margin-top: 48px;">
    <div class="section-header">
        <h2 class="section-title">Explore Other Categories</h2>
    </div>
    <div class="row g-3">
        {% for cat_id, category in categories.items() %}
        {% if category.id != selected_category.id %}
        <div class="col-md-4 col-lg-3">
            <a href="/guides/{{ category.id }}" class="cat-card" style="--cat-color: {{ category.color }}; padding: 16px;">
                <div class="cat-icon" style="background: {{ category.color }}22; color: {{ category.color }}; width: 40px; height: 40px; font-size: 16px;">
                    <i class="{{ category.icon }}"></i>
                </div>
                <h5 class="cat-title" style="font-size: 14px;">{{ category.title }}</h5>
                <span class="cat-count">
                    <i class="bi bi-book"></i>
                    {% if category.guides %}{{ category.guides|length }} guides{% elif category.provinces %}{{ category.provinces|length }} provinces{% endif %}
                </span>
            </a>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</div>

{% else %}
<!-- Main Guides Page -->
<div class="page-header">
    <h1 class="page-title">Immigration Guides</h1>
    <p class="page-subtitle">Comprehensive guides covering every pathway to Canadian immigration</p>
</div>

<!-- Stats Row -->
<div class="stats-row">
    <div class="stat-card">
        <div class="stat-value">50+</div>
        <div class="stat-label">Guides</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">13</div>
        <div class="stat-label">Provinces</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">10+</div>
        <div class="stat-label">Forms Guides</div>
    </div>
</div>

<!-- Search Box -->
<div class="guide-search">
    <i class="bi bi-search"></i>
    <input type="text" id="guideSearch" placeholder="Search guides...">
</div>

<!-- Main Categories -->
<div class="section">
    <div class="section-header">
        <h2 class="section-title">Explore by Category</h2>
    </div>
    <div class="row g-4">
        {% for cat_id, category in categories.items() %}
        <div class="col-md-6 col-lg-4">
            <a href="/guides/{{ category.id }}" class="cat-card" style="--cat-color: {{ category.color }}">
                <div class="cat-icon" style="background: {{ category.color }}22; color: {{ category.color }};">
                    <i class="{{ category.icon }}"></i>
                </div>
                <h3 class="cat-title">{{ category.title }}</h3>
                <p class="cat-desc">{{ category.description }}</p>
                <span class="cat-count">
                    <i class="bi bi-book"></i>
                    {% if category.guides %}{{ category.guides|length }} guides{% elif category.provinces %}{{ category.provinces|length }} provinces{% endif %}
                </span>
                <div class="cat-arrow">
                    <i class="bi bi-arrow-right"></i>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Provincial Programs -->
<div class="section" id="pnp">
    <div class="section-header">
        <h2 class="section-title">Provincial Nominee Programs</h2>
        <a href="/guides/pnp" class="section-link">View All <i class="bi bi-chevron-right"></i></a>
    </div>
    <div class="province-grid">
        {% if categories.provincial_programs and categories.provincial_programs.provinces %}
        {% for province in categories.provincial_programs.provinces[:6] %}
        <a href="/guides/pnp/{{ province.id }}" class="province-card" style="--province-color: {{ ['#C41E3A', '#F59E0B', '#10B981', '#6366F1', '#0EA5E9', '#8B5CF6'][loop.index0 % 6] }}">
            <div class="province-header">
                <div class="province-flag" style="background: {{ ['#C41E3A', '#F59E0B', '#10B981', '#6366F1', '#0EA5E9', '#8B5CF6'][loop.index0 % 6] }};">{{ province.code }}</div>
                <div>
                    <div class="province-name">{{ province.name }}</div>
                    <div class="province-code">{{ province.program_name }}</div>
                </div>
            </div>
            <div class="province-stats">
                <span><strong>{{ province.streams|length }}</strong> streams</span>
                <span>Capital: <strong>{{ province.capital }}</strong></span>
            </div>
        </a>
        {% endfor %}
        {% endif %}
    </div>
</div>

<!-- Featured Guides -->
<div class="section">
    <div class="section-header">
        <h2 class="section-title">Most Popular Guides</h2>
    </div>
    <div class="row g-4">
        <div class="col-md-6 col-lg-3">
            <a href="/guides/study-permit" class="featured-card">
                <div class="featured-image" style="background: linear-gradient(135deg, #6366F1, #8B5CF6);">
                    <span>üéì</span>
                </div>
                <div class="featured-content">
                    <span class="featured-badge">Study</span>
                    <h4 class="featured-title">Study Permit Guide</h4>
                    <p class="featured-desc">Complete guide to studying in Canada</p>
                </div>
            </a>
        </div>
        <div class="col-md-6 col-lg-3">
            <a href="/guides/express-entry" class="featured-card">
                <div class="featured-image" style="background: linear-gradient(135deg, #C41E3A, #FF6B6B);">
                    <span>üöÄ</span>
                </div>
                <div class="featured-content">
                    <span class="featured-badge">Immigration</span>
                    <h4 class="featured-title">Express Entry Guide</h4>
                    <p class="featured-desc">Canada's fastest PR pathway</p>
                </div>
            </a>
        </div>
        <div class="col-md-6 col-lg-3">
            <a href="/guides/credentials/wes" class="featured-card">
                <div class="featured-image" style="background: linear-gradient(135deg, #10B981, #34D399);">
                    <span>üìú</span>
                </div>
                <div class="featured-content">
                    <span class="featured-badge">Credentials</span>
                    <h4 class="featured-title">WES ECA Guide</h4>
                    <p class="featured-desc">Credential evaluation process</p>
                </div>
            </a>
        </div>
        <div class="col-md-6 col-lg-3">
            <a href="/guides/pnp/ontario" class="featured-card">
                <div class="featured-image" style="background: linear-gradient(135deg, #F59E0B, #FBBF24);">
                    <span>üçÅ</span>
                </div>
                <div class="featured-content">
                    <span class="featured-badge">PNP</span>
                    <h4 class="featured-title">Ontario OINP Guide</h4>
                    <p class="featured-desc">Canada's largest provincial program</p>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- CTA -->
<div class="section">
    <div class="cta-card">
        <h2 class="cta-title">Need Help Choosing Your Path?</h2>
        <p class="cta-desc">Start with Express Entry if you're unsure, or explore provincial programs for more options.</p>
        <div class="cta-buttons">
            <a href="/guides/express-entry" class="btn btn-white">
                <i class="bi bi-lightning-charge me-2"></i>Start with Express Entry
            </a>
            <a href="/tools/crs-calculator" class="btn btn-outline-white">
                <i class="bi bi-calculator me-2"></i>Calculate CRS Score
            </a>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    const searchInput = document.getElementById('guideSearch');
    if (searchInput) {
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            document.querySelectorAll('.cat-card, .province-card, .featured-card').forEach(card => {
                const text = card.textContent.toLowerCase();
                const parent = card.closest('.col-md-6, .col-lg-3, .col-lg-4');
                if (parent) {
                    parent.style.display = text.includes(query) ? '' : 'none';
                } else {
                    card.style.display = text.includes(query) ? '' : 'none';
                }
            });
        });
    }
</script>
{% endblock %}
