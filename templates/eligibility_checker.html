{% extends "base.html" %}

{% block title %}Immigration Pathway Finder - RCIC-Style Assessment{% endblock %}

{% block extra_css %}
<style>
    .page-header { margin-bottom: 32px; }
    .page-header .page-title {
        font-family: 'Plus Jakarta Sans', var(--font-family);
        font-size: 32px; font-weight: 800; color: var(--text);
        margin-bottom: 8px; display: flex; align-items: center; gap: 14px;
    }
    .page-header .page-title i { font-size: 28px; color: var(--primary); }
    .page-subtitle { color: var(--text-muted); font-size: 1rem; }

    /* Progress Steps */
    .progress-container { overflow-x: auto; padding: 0.5rem 0; margin-bottom: 2rem; }
    .progress-steps { display: flex; justify-content: center; gap: 0; min-width: max-content; }
    .step { display: flex; align-items: center; gap: 0.5rem; }
    .step-number {
        width: 32px; height: 32px; border-radius: 50%;
        background: var(--bg); border: 2px solid var(--border);
        display: flex; align-items: center; justify-content: center;
        font-weight: 600; font-size: 0.85rem; color: var(--text-muted); transition: all 0.3s;
    }
    .step.active .step-number { background: var(--primary); border-color: var(--primary); color: white; }
    .step.completed .step-number { background: #16a34a; border-color: #16a34a; color: white; }
    .step-label { font-size: 0.75rem; color: var(--text-muted); max-width: 60px; text-align: center; }
    .step-line { width: 30px; height: 2px; background: var(--border); margin: 0 0.25rem; }
    .step.completed + .step-line { background: #16a34a; }

    /* Question Card */
    .question-card {
        background: var(--card); border: 1px solid var(--border);
        border-radius: 16px; padding: 2rem; max-width: 800px; margin: 0 auto 2rem;
    }
    .question-header { margin-bottom: 1.5rem; }
    .question-header .category {
        font-size: 0.85rem; color: var(--primary); font-weight: 600;
        text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;
    }
    .question-header h2 { font-size: 1.4rem; color: var(--text); font-weight: 700; line-height: 1.4; }
    .question-header .help-text { font-size: 0.9rem; color: var(--text-muted); margin-top: 0.5rem; }

    /* Options */
    .options-grid { display: grid; gap: 0.75rem; margin-bottom: 1.5rem; }
    .option-btn {
        display: flex; align-items: center; gap: 1rem; padding: 1rem;
        background: var(--bg); border: 2px solid var(--border); border-radius: 12px;
        cursor: pointer; transition: all 0.2s; text-align: left;
    }
    .option-btn:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
    .option-btn.selected { border-color: var(--primary); background: rgba(59, 130, 246, 0.1); }
    .option-btn .radio {
        width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 50%;
        display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .option-btn.selected .radio { border-color: var(--primary); background: var(--primary); }
    .option-btn.selected .radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
    .option-btn .option-text { flex: 1; }
    .option-btn .option-title { font-weight: 600; color: var(--text); }
    .option-btn .option-desc { font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem; }

    /* Search Input */
    .search-container { position: relative; margin-bottom: 1rem; }
    .search-input {
        width: 100%; padding: 1rem; border: 2px solid var(--border); border-radius: 12px;
        font-size: 1rem; background: var(--bg); color: var(--text);
    }
    .search-input:focus { outline: none; border-color: var(--primary); }
    .search-results {
        position: absolute; top: 100%; left: 0; right: 0; background: var(--card);
        border: 1px solid var(--border); border-radius: 12px; max-height: 300px;
        overflow-y: auto; z-index: 100; display: none; margin-top: 0.5rem;
    }
    .search-results.show { display: block; }
    .search-result-item {
        padding: 1rem; cursor: pointer; border-bottom: 1px solid var(--border);
    }
    .search-result-item:hover { background: var(--bg); }
    .search-result-item:last-child { border-bottom: none; }
    .search-result-item .noc-code { font-weight: 700; color: var(--primary); }
    .search-result-item .noc-title { color: var(--text); }
    .search-result-item .noc-teer { font-size: 0.8rem; color: var(--text-muted); }

    /* Navigation */
    .nav-buttons { display: flex; justify-content: space-between; margin-top: 2rem; }
    .nav-btn {
        padding: 0.75rem 1.5rem; border-radius: 10px; font-weight: 600;
        cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem;
    }
    .nav-btn.back { background: var(--bg); border: 1px solid var(--border); color: var(--text); }
    .nav-btn.next { background: var(--primary); border: none; color: white; }
    .nav-btn:hover { transform: translateY(-1px); }
    .nav-btn.next:hover { background: var(--primary-hover); }
    .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    /* Inline Error Notification */
    .error-notification {
        display: flex; align-items: center; gap: 0.75rem;
        background: #fef2f2; border: 1px solid #fecaca; border-radius: 10px;
        padding: 0.875rem 1rem; margin-bottom: 1rem; color: #dc2626;
        font-weight: 500; font-size: 0.95rem;
    }
    .error-notification i { font-size: 1.25rem; flex-shrink: 0; }
    .error-notification.shake { animation: shake 0.5s ease-in-out; }
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        50% { transform: translateX(5px); }
        75% { transform: translateX(-5px); }
    }

    /* Dark mode error notification */
    [data-theme="dark"] .error-notification {
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.3);
    }

    /* Results Section */
    .results-section { display: none; max-width: 1000px; margin: 0 auto; }
    .results-section.show { display: block; }

    .results-header {
        background: linear-gradient(135deg, #1E3A5F 0%, #0891B2 100%);
        border-radius: 16px; padding: 2rem; color: white; text-align: center; margin-bottom: 2rem;
    }
    .results-header h2 { font-size: 1.75rem; margin-bottom: 0.5rem; }
    .results-header p { opacity: 0.9; }
    .crs-display { font-size: 3rem; font-weight: 800; margin: 1rem 0; }
    .crs-label { font-size: 0.9rem; opacity: 0.8; }

    /* Profile Summary */
    .profile-summary {
        background: var(--card); border: 1px solid var(--border);
        border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem;
    }
    .profile-summary h3 { font-size: 1.1rem; color: var(--text); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
    .profile-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem; }
    .profile-item { padding: 0.75rem; background: var(--bg); border-radius: 8px; }
    .profile-item .label { font-size: 0.8rem; color: var(--text-muted); }
    .profile-item .value { font-weight: 600; color: var(--text); }

    /* Program Cards */
    .section-title { font-size: 1.25rem; color: var(--text); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
    .section-title i { color: var(--primary); }
    .program-card {
        background: var(--card); border: 1px solid var(--border);
        border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;
    }
    .program-card.eligible { border-left: 4px solid #16a34a; }
    .program-card.likely { border-left: 4px solid #eab308; }
    .program-card.not-eligible { border-left: 4px solid #dc2626; opacity: 0.7; }
    .program-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
    .program-name { font-size: 1.1rem; font-weight: 700; color: var(--text); }
    .eligibility-badge { padding: 0.4rem 0.8rem; border-radius: 8px; font-size: 0.85rem; font-weight: 600; }
    .eligibility-badge.eligible { background: rgba(34, 197, 94, 0.1); color: #16a34a; }
    .eligibility-badge.likely { background: rgba(234, 179, 8, 0.1); color: #ca8a04; }
    .eligibility-badge.not-eligible { background: rgba(239, 68, 68, 0.1); color: #dc2626; }
    .requirements { margin-bottom: 1rem; }
    .req-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0; font-size: 0.9rem; }
    .req-item i { width: 18px; }
    .req-item i.bi-check-circle-fill { color: #16a34a; }
    .req-item i.bi-x-circle-fill { color: #dc2626; }
    .req-item i.bi-question-circle-fill { color: #ca8a04; }
    .program-recommendation { font-size: 0.9rem; color: var(--text-muted); padding: 0.75rem; background: var(--bg); border-radius: 8px; }

    /* Pathway Cards */
    .pathway-card {
        background: var(--card); border: 1px solid var(--border);
        border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; position: relative;
    }
    .pathway-card.recommended { border-color: var(--primary); }
    .pathway-badge {
        position: absolute; top: -10px; left: 1rem; background: var(--primary);
        color: white; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600;
    }
    .pathway-card h4 { font-size: 1.1rem; color: var(--text); margin-bottom: 0.5rem; }
    .pathway-match { display: flex; align-items: center; gap: 0.5rem; color: #16a34a; font-size: 0.9rem; margin-bottom: 1rem; }
    .pathway-benefit { font-size: 0.9rem; background: rgba(34, 197, 94, 0.1); padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; }
    .pathway-cta {
        display: inline-flex; align-items: center; gap: 0.25rem;
        color: var(--primary); font-weight: 600; font-size: 0.9rem;
    }
    .pathway-requirements {
        font-size: 0.85rem; color: var(--text-muted);
        padding: 0.75rem; background: var(--bg); border-radius: 8px; margin-bottom: 1rem;
    }
    .pathway-card.not-eligible { opacity: 0.7; border-color: #dc2626; }
    .pathway-card.not-eligible .pathway-match { color: #dc2626; }

    /* Pathway Stream Title */
    .pathway-stream { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.75rem; }

    /* Provincial Score Bar */
    .pathway-score { margin-bottom: 1rem; }
    .score-bar {
        height: 12px; background: var(--bg); border-radius: 6px;
        position: relative; overflow: visible; margin-bottom: 0.5rem;
    }
    .score-fill {
        height: 100%; border-radius: 6px; transition: width 0.5s ease;
    }
    .score-fill.eligible { background: linear-gradient(90deg, #16a34a, #22c55e); }
    .score-fill.not-eligible { background: linear-gradient(90deg, #dc2626, #f87171); }
    .score-threshold {
        position: absolute; top: -4px; width: 3px; height: 20px;
        background: var(--text); border-radius: 2px;
    }
    .score-text { font-size: 0.85rem; color: var(--text-muted); font-weight: 500; }

    /* Improvement Cards */
    .improvement-card {
        background: var(--card); border: 1px solid var(--border);
        border-radius: 12px; padding: 1.25rem; margin-bottom: 0.75rem;
        display: grid; grid-template-columns: 1fr auto; gap: 1rem; align-items: center;
    }
    .improvement-action { font-weight: 600; color: var(--text); }
    .improvement-details { font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem; }
    .improvement-gain {
        background: linear-gradient(135deg, #16a34a, #22c55e);
        color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 700; white-space: nowrap;
    }

    /* Warning Cards */
    .warning-card {
        background: var(--card); border: 1px solid var(--border);
        border-radius: 12px; padding: 1rem; margin-bottom: 0.75rem;
        display: flex; gap: 1rem; align-items: flex-start;
    }
    .warning-card.urgent { border-left: 4px solid #dc2626; }
    .warning-card.concern { border-left: 4px solid #eab308; }
    .warning-card.info { border-left: 4px solid #3b82f6; }
    .warning-icon { font-size: 1.25rem; }
    .warning-card.urgent .warning-icon { color: #dc2626; }
    .warning-card.concern .warning-icon { color: #eab308; }
    .warning-card.info .warning-icon { color: #3b82f6; }
    .warning-issue { font-weight: 600; color: var(--text); }
    .warning-action { font-size: 0.9rem; color: var(--text-muted); margin-top: 0.25rem; }

    /* Alternative Pathways */
    .alt-pathway {
        background: var(--card); border: 1px solid var(--border);
        border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;
    }
    .alt-pathway h4 { font-size: 1.1rem; color: var(--text); margin-bottom: 0.5rem; }
    .alt-pathway .description { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem; }
    .alt-pathway .timeline { display: inline-block; background: var(--bg); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.85rem; margin-bottom: 1rem; }
    .pros-cons { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .pros h5, .cons h5 { font-size: 0.85rem; margin-bottom: 0.5rem; }
    .pros h5 { color: #16a34a; }
    .cons h5 { color: #dc2626; }
    .pros li, .cons li { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.25rem; }

    .restart-btn {
        display: flex; align-items: center; justify-content: center; gap: 0.5rem;
        padding: 1rem 2rem; background: var(--bg); border: 1px solid var(--border);
        border-radius: 10px; font-weight: 600; cursor: pointer; margin: 2rem auto 0; transition: all 0.2s;
    }
    .restart-btn:hover { border-color: var(--primary); color: var(--primary); }

    .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
    @media (max-width: 900px) { .results-grid { grid-template-columns: 1fr; } }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="bi bi-clipboard-check"></i>
        Immigration Pathway Finder
    </h1>
    <p class="page-subtitle">Answer questions like you would with an immigration consultant to discover your best pathways to Canada</p>
</div>

<div class="progress-container">
    <div class="progress-steps" id="progressSteps">
        <div class="step active" data-step="1"><div class="step-number">1</div><span class="step-label">Personal</span></div>
        <div class="step-line"></div>
        <div class="step" data-step="2"><div class="step-number">2</div><span class="step-label">Status</span></div>
        <div class="step-line"></div>
        <div class="step" data-step="3"><div class="step-number">3</div><span class="step-label">Education</span></div>
        <div class="step-line"></div>
        <div class="step" data-step="4"><div class="step-number">4</div><span class="step-label">Work</span></div>
        <div class="step-line"></div>
        <div class="step" data-step="5"><div class="step-number">5</div><span class="step-label">Language</span></div>
        <div class="step-line"></div>
        <div class="step" data-step="6"><div class="step-number">6</div><span class="step-label">Job Offer</span></div>
        <div class="step-line"></div>
        <div class="step" data-step="7"><div class="step-number">7</div><span class="step-label">Family</span></div>
        <div class="step-line"></div>
        <div class="step" data-step="8"><div class="step-number">8</div><span class="step-label">Spouse</span></div>
        <div class="step-line"></div>
        <div class="step" data-step="9"><div class="step-number">9</div><span class="step-label">History</span></div>
        <div class="step-line"></div>
        <div class="step" data-step="10"><div class="step-number">10</div><span class="step-label">Results</span></div>
    </div>
</div>

<div id="questionContainer"></div>

<div class="results-section" id="resultsSection">
    <div class="results-header">
        <h2>Your Immigration Assessment</h2>
        <p>Based on your answers, here's your personalized pathway analysis</p>
        <div class="crs-display" id="crsScore">--</div>
        <div class="crs-label">Estimated CRS Score</div>
    </div>

    <div class="profile-summary">
        <h3><i class="bi bi-person-badge"></i> Your Profile Summary</h3>
        <div class="profile-grid" id="profileGrid"></div>
    </div>

    <!-- Warnings Section -->
    <div id="warningsSection" style="margin-bottom: 2rem;"></div>

    <div class="results-grid">
        <div>
            <!-- Program Eligibility -->
            <h3 class="section-title"><i class="bi bi-check2-square"></i> Program Eligibility</h3>
            <div id="programResults"></div>

            <!-- Provincial Pathways -->
            <h3 class="section-title" style="margin-top: 2rem;"><i class="bi bi-geo-alt"></i> Provincial Pathways</h3>
            <div id="provincialResults"></div>
        </div>

        <div>
            <!-- Score Improvements -->
            <h3 class="section-title"><i class="bi bi-graph-up-arrow"></i> How to Improve Your Score</h3>
            <div id="improvementResults"></div>

            <!-- Alternative Pathways -->
            <h3 class="section-title" style="margin-top: 2rem;"><i class="bi bi-signpost-split"></i> Alternative Pathways</h3>
            <div id="alternativeResults"></div>
        </div>
    </div>

    <!-- Career Transitions (if applicable) -->
    <div id="careerSection" style="margin-top: 2rem;"></div>

    <button class="restart-btn" onclick="restartChecker()">
        <i class="bi bi-arrow-counterclockwise"></i> Start Over
    </button>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/eligibility_data.js"></script>
<script src="/static/js/eligibility_engine.js"></script>
{% endblock %}
