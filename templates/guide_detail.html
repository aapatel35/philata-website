{% extends "base.html" %}

{% block title %}{{ guide.title }}{% endblock %}

{% block extra_css %}
<style>
    /* Breadcrumb */
    .breadcrumb-section {
        padding: 1rem 0;
        border-bottom: 1px solid var(--border);
        margin-bottom: 1.5rem;
    }

    .breadcrumb {
        background: none;
        padding: 0;
        margin: 0;
    }

    .breadcrumb-item a {
        color: var(--text-muted);
        text-decoration: none;
    }

    .breadcrumb-item a:hover {
        color: var(--primary);
    }

    .breadcrumb-item.active {
        color: var(--accent);
    }

    .breadcrumb-item + .breadcrumb-item::before {
        color: var(--text-light);
    }

    /* Guide Header */
    .guide-header {
        padding: 2rem 0;
        position: relative;
        overflow: hidden;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        margin-bottom: 2rem;
    }

    .guide-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(ellipse at top left, {{ category.color }}15 0%, transparent 50%);
        pointer-events: none;
    }

    .guide-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        display: block;
    }

    .guide-title {
        font-size: 2rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        color: var(--text);
    }

    .guide-subtitle {
        font-size: 1.1rem;
        color: var(--text-muted);
        margin-bottom: 1.5rem;
    }

    .guide-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-muted);
    }

    .meta-item i {
        color: {{ category.color }};
    }

    /* Content Sections */
    .content-section {
        padding: 2rem 0;
        border-bottom: 1px solid var(--border);
    }

    .content-section:last-child {
        border-bottom: none;
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .section-icon {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        background: {{ category.color }}22;
        display: flex;
        align-items: center;
        justify-content: center;
        color: {{ category.color }};
        font-size: 1.1rem;
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text);
        margin: 0;
    }

    /* Key Facts Grid */
    .facts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }

    .fact-card {
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.25rem;
        transition: all 0.2s ease;
    }

    .fact-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .fact-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 0.5rem;
    }

    .fact-value {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text);
    }

    /* CLB Table */
    .clb-table {
        background: var(--card);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid var(--border);
    }

    .clb-table table {
        width: 100%;
        margin: 0;
    }

    .clb-table th {
        background: var(--bg);
        padding: 1rem;
        font-weight: 600;
        color: var(--text);
        text-align: center;
        border-bottom: 1px solid var(--border);
    }

    .clb-table td {
        padding: 1rem;
        text-align: center;
        color: var(--text);
        border-bottom: 1px solid var(--border);
    }

    .clb-table tr:last-child td {
        border-bottom: none;
    }

    .clb-table tr:hover td {
        background: var(--bg);
    }

    .clb-level {
        font-weight: 700;
        color: {{ category.color }};
    }

    /* Tips List */
    .tips-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .tips-list li {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid var(--border);
    }

    .tips-list li:last-child {
        border-bottom: none;
    }

    .tip-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        flex-shrink: 0;
    }

    .tip-text {
        color: var(--text);
        line-height: 1.6;
    }

    /* Mistakes List */
    .mistakes-list li .tip-icon {
        background: linear-gradient(135deg, #EF4444 0%, #F87171 100%);
    }

    /* Step by Step */
    .steps-container {
        position: relative;
    }

    .steps-container::before {
        content: '';
        position: absolute;
        left: 24px;
        top: 40px;
        bottom: 40px;
        width: 2px;
        background: var(--border);
    }

    .step-item {
        display: flex;
        gap: 1.5rem;
        padding: 1.5rem 0;
        position: relative;
    }

    .step-number {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: {{ category.color }};
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.25rem;
        color: white;
        flex-shrink: 0;
        position: relative;
        z-index: 1;
    }

    .step-content h4 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text);
    }

    .step-content p {
        color: var(--text-muted);
        margin: 0;
    }

    /* Resources */
    .resource-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .resource-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        border-color: {{ category.color }};
    }

    .resource-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: {{ category.color }}22;
        display: flex;
        align-items: center;
        justify-content: center;
        color: {{ category.color }};
    }

    .resource-name {
        font-weight: 600;
        color: var(--text);
    }

    .resource-url {
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    /* Sidebar */
    .sidebar-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        position: sticky;
        top: 80px;
    }

    .sidebar-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .toc-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .toc-list a {
        display: block;
        padding: 0.5rem 0;
        color: var(--text-muted);
        font-size: 0.9rem;
        border-left: 2px solid transparent;
        padding-left: 1rem;
        transition: all 0.2s ease;
        text-decoration: none;
    }

    .toc-list a:hover, .toc-list a.active {
        color: {{ category.color }};
        border-left-color: {{ category.color }};
    }

    /* Programs/Streams Cards */
    .program-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        transition: all 0.2s ease;
    }

    .program-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        border-color: {{ category.color }}55;
    }

    .program-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }

    .program-name {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text);
    }

    .program-type {
        font-size: 0.75rem;
        padding: 4px 12px;
        border-radius: 20px;
        background: {{ category.color }}22;
        color: {{ category.color }};
        font-weight: 600;
    }

    .program-desc {
        color: var(--text-muted);
        margin-bottom: 1rem;
        line-height: 1.6;
    }

    .requirement-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .requirement-list li {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        padding: 0.5rem 0;
        color: var(--text);
        font-size: 0.9rem;
    }

    .requirement-list li i {
        color: {{ category.color }};
        margin-top: 3px;
    }

    /* CRS Breakdown Grid */
    .crs-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    .crs-category {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.25rem;
    }

    .crs-category-title {
        font-size: 1rem;
        font-weight: 700;
        color: {{ category.color }};
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--border);
    }

    .crs-item {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--border);
    }

    .crs-item:last-child {
        border-bottom: none;
    }

    .crs-label {
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    .crs-value {
        color: var(--text);
        font-weight: 600;
        font-size: 0.9rem;
    }

    /* Improvement Strategies */
    .strategy-card {
        background: {{ category.color }}08;
        border: 1px solid {{ category.color }}33;
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
    }

    .strategy-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .strategy-points {
        background: {{ category.color }};
        color: white;
        padding: 6px 14px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 0.85rem;
    }

    .strategy-change {
        font-size: 0.9rem;
        color: var(--text-muted);
    }

    .strategy-change span {
        color: #059669;
        font-weight: 600;
    }

    .strategy-text {
        color: var(--text);
        line-height: 1.6;
    }

    /* Places to Explore */
    .places-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }

    .place-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        transition: all 0.2s ease;
    }

    .place-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .place-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .place-name {
        color: var(--text);
        font-weight: 600;
    }

    /* Living Costs Table */
    .costs-table {
        background: var(--card);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid var(--border);
    }

    .costs-table table {
        width: 100%;
        margin: 0;
    }

    .costs-table th {
        background: var(--bg);
        padding: 1rem;
        font-weight: 600;
        color: var(--text);
        text-align: left;
        border-bottom: 1px solid var(--border);
    }

    .costs-table td {
        padding: 1rem;
        color: var(--text);
        border-bottom: 1px solid var(--border);
    }

    .costs-table tr:last-child td {
        border-bottom: none;
    }

    .costs-table tr:hover td {
        background: var(--bg);
    }

    /* Occupations Grid */
    .occupations-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
    }

    .occupation-tag {
        background: {{ category.color }}15;
        border: 1px solid {{ category.color }}44;
        color: {{ category.color }};
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    /* Before You Start Checklist */
    .checklist {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .checklist li {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
        margin-bottom: 0.5rem;
        background: var(--card);
        border-radius: 12px;
        border: 1px solid var(--border);
        color: var(--text);
    }

    .checklist li i {
        color: {{ category.color }};
        margin-top: 3px;
    }

    /* Form Sections */
    .form-section-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
    }

    .form-section-name {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .form-section-name i {
        color: {{ category.color }};
    }

    .form-fields {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .form-field {
        background: var(--bg);
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 0.85rem;
        color: var(--text);
    }

    .form-section-tip {
        background: rgba(16, 185, 129, 0.1);
        border-left: 3px solid #10B981;
        padding: 0.75rem 1rem;
        border-radius: 0 8px 8px 0;
        font-size: 0.9rem;
        color: var(--text);
    }

    /* Test Sections */
    .test-section-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
    }

    .test-section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }

    .test-section-name {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text);
    }

    .test-section-duration {
        font-size: 0.85rem;
        color: {{ category.color }};
        font-weight: 600;
    }

    .test-section-info {
        display: flex;
        gap: 2rem;
        margin-bottom: 1rem;
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    .test-section-tips {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .test-section-tips li {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        padding: 0.5rem 0;
        font-size: 0.9rem;
        color: var(--text);
    }

    .test-section-tips li i {
        color: #059669;
        margin-top: 3px;
    }

    /* Advantages List */
    .advantages-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .advantages-list li {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: var(--card);
        border-radius: 12px;
        margin-bottom: 0.5rem;
        border: 1px solid var(--border);
        color: var(--text);
    }

    .advantages-list li i {
        color: #059669;
        font-size: 1.25rem;
    }

    /* Info Box */
    .info-box {
        background: rgba(59, 130, 246, 0.08);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 12px;
        padding: 1rem 1.25rem;
        margin-bottom: 1rem;
    }

    .info-box p {
        color: var(--text);
        margin: 0;
    }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<section class="breadcrumb-section">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/guides">Guides</a></li>
                <li class="breadcrumb-item"><a href="/guides/{{ category.id }}">{{ category.title }}</a></li>
                <li class="breadcrumb-item active">{{ guide.title }}</li>
            </ol>
        </nav>
    </div>
</section>

<!-- Guide Header -->
<section class="guide-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <span class="guide-icon animate-in">{{ guide.icon }}</span>
                <h1 class="guide-title animate-in delay-1">{{ guide.title }}</h1>
                <p class="guide-subtitle animate-in delay-2">{{ guide.subtitle }}</p>

                <div class="guide-meta animate-in delay-3">
                    {% if guide.difficulty %}
                    <div class="meta-item">
                        <i class="bi bi-bar-chart"></i>
                        <span>{{ guide.difficulty }}</span>
                    </div>
                    {% endif %}
                    {% if guide.duration %}
                    <div class="meta-item">
                        <i class="bi bi-clock"></i>
                        <span>{{ guide.duration }}</span>
                    </div>
                    {% endif %}
                </div>

                <p class="text-muted">{{ guide.overview }}</p>
            </div>
        </div>
    </div>
</section>

<div class="container">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Key Facts -->
            {% if guide.key_facts %}
            <section class="content-section" id="key-facts">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-info-circle"></i></div>
                    <h2 class="section-title">Key Facts</h2>
                </div>
                <div class="facts-grid">
                    {% for key, value in guide.key_facts.items() %}
                    {% if value is string or value is number %}
                    <div class="fact-card">
                        <div class="fact-label">{{ key|replace('_', ' ')|title }}</div>
                        <div class="fact-value">{{ value }}</div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Programs (Express Entry) -->
            {% if guide.programs %}
            <section class="content-section" id="programs">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-diagram-3"></i></div>
                    <h2 class="section-title">Immigration Programs</h2>
                </div>
                {% for program in guide.programs %}
                <div class="program-card">
                    <div class="program-header">
                        <span class="program-name">{{ program.name }}</span>
                        {% if program.processing %}
                        <span class="program-type">{{ program.processing }}</span>
                        {% endif %}
                    </div>
                    <p class="program-desc">{{ program.description }}</p>
                    {% if program.requirements %}
                    <ul class="requirement-list">
                        {% for req in program.requirements %}
                        <li><i class="bi bi-check-circle"></i> {{ req }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% if program.best_for %}
                    <p class="mt-2 mb-0"><strong style="color: {{ category.color }};">Best for:</strong> <span class="text-muted">{{ program.best_for }}</span></p>
                    {% endif %}
                </div>
                {% endfor %}
            </section>
            {% endif %}

            <!-- CRS Breakdown (Express Entry) -->
            {% if guide.crs_breakdown %}
            <section class="content-section" id="crs-breakdown">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-calculator"></i></div>
                    <h2 class="section-title">CRS Points Breakdown</h2>
                </div>
                {% if guide.crs_breakdown.description %}
                <div class="info-box">
                    <p>{{ guide.crs_breakdown.description }}</p>
                </div>
                {% endif %}
                <div class="crs-grid">
                    {% if guide.crs_breakdown.core_factors %}
                    <div class="crs-category">
                        <div class="crs-category-title">{{ guide.crs_breakdown.core_factors.title or 'Core Factors' }}</div>
                        {% if guide.crs_breakdown.core_factors.age %}
                        <div class="crs-item">
                            <span class="crs-label">Age (peak: {{ guide.crs_breakdown.core_factors.age.peak_age }})</span>
                            <span class="crs-value">{{ guide.crs_breakdown.core_factors.age.max_points }}</span>
                        </div>
                        {% endif %}
                        {% if guide.crs_breakdown.core_factors.education %}
                        <div class="crs-item">
                            <span class="crs-label">Education (Doctorate)</span>
                            <span class="crs-value">{{ guide.crs_breakdown.core_factors.education.doctorate }}</span>
                        </div>
                        <div class="crs-item">
                            <span class="crs-label">Education (Master's)</span>
                            <span class="crs-value">{{ guide.crs_breakdown.core_factors.education.masters }}</span>
                        </div>
                        {% endif %}
                        {% if guide.crs_breakdown.core_factors.language %}
                        <div class="crs-item">
                            <span class="crs-label">Language (CLB 10)</span>
                            <span class="crs-value">{{ guide.crs_breakdown.core_factors.language.per_ability_clb10 }}</span>
                        </div>
                        <div class="crs-item">
                            <span class="crs-label">Language (CLB 9)</span>
                            <span class="crs-value">{{ guide.crs_breakdown.core_factors.language.per_ability_clb9 }}</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    {% if guide.crs_breakdown.additional_factors %}
                    <div class="crs-category">
                        <div class="crs-category-title">{{ guide.crs_breakdown.additional_factors.title or 'Additional Factors' }}</div>
                        {% if guide.crs_breakdown.additional_factors.provincial_nomination %}
                        <div class="crs-item">
                            <span class="crs-label">Provincial Nomination</span>
                            <span class="crs-value">{{ guide.crs_breakdown.additional_factors.provincial_nomination }}</span>
                        </div>
                        {% endif %}
                        {% if guide.crs_breakdown.additional_factors.canadian_education_3yr %}
                        <div class="crs-item">
                            <span class="crs-label">Canadian Education (3yr+)</span>
                            <span class="crs-value">{{ guide.crs_breakdown.additional_factors.canadian_education_3yr }}</span>
                        </div>
                        {% endif %}
                        {% if guide.crs_breakdown.additional_factors.sibling_in_canada %}
                        <div class="crs-item">
                            <span class="crs-label">Sibling in Canada</span>
                            <span class="crs-value">{{ guide.crs_breakdown.additional_factors.sibling_in_canada }}</span>
                        </div>
                        {% endif %}
                        {% if guide.crs_breakdown.additional_factors.french_ability %}
                        <div class="crs-item">
                            <span class="crs-label">French Ability</span>
                            <span class="crs-value">{{ guide.crs_breakdown.additional_factors.french_ability }}</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </section>
            {% endif %}

            <!-- Improvement Strategies (Express Entry) -->
            {% if guide.improvement_strategies %}
            <section class="content-section" id="improvement">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-graph-up-arrow"></i></div>
                    <h2 class="section-title">CRS Improvement Strategies</h2>
                </div>
                {% for strategy in guide.improvement_strategies %}
                <div class="strategy-card">
                    <div class="strategy-header">
                        <span class="strategy-points">{{ strategy.strategy or strategy.action }}</span>
                        <span class="strategy-change">Impact: <span>{{ strategy.impact or strategy.points_gain }}</span></span>
                    </div>
                    {% if strategy.difficulty or strategy.timeline %}
                    <p class="mb-2"><small class="text-muted"><i class="bi bi-clock me-1"></i>{{ strategy.timeline }} | Difficulty: {{ strategy.difficulty }}</small></p>
                    {% endif %}
                    <p class="strategy-text">{{ strategy.details }}</p>
                </div>
                {% endfor %}
            </section>
            {% endif %}

            <!-- Streams (Provincial Programs) -->
            {% if guide.streams %}
            <section class="content-section" id="streams">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-signpost-split"></i></div>
                    <h2 class="section-title">Immigration Streams</h2>
                </div>
                {% for stream in guide.streams %}
                <div class="program-card">
                    <div class="program-header">
                        <span class="program-name">{{ stream.name }}</span>
                        <span class="program-type">{{ stream.type }}</span>
                    </div>
                    {% if stream.requirements %}
                    <ul class="requirement-list">
                        {% for req in stream.requirements %}
                        <li><i class="bi bi-check-circle"></i> {{ req }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% if stream.notes %}
                    <p class="mt-2 mb-0 text-muted"><i class="bi bi-info-circle me-2"></i>{{ stream.notes }}</p>
                    {% endif %}
                    {% if stream.job_offer_required %}
                    <p class="mt-2 mb-0"><span class="occupation-tag">Job Offer Required</span></p>
                    {% endif %}
                </div>
                {% endfor %}
            </section>
            {% endif %}

            <!-- In-Demand Occupations (Provincial) -->
            {% if guide.in_demand_occupations %}
            <section class="content-section" id="occupations">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-briefcase"></i></div>
                    <h2 class="section-title">In-Demand Occupations</h2>
                </div>
                <div class="occupations-grid">
                    {% for occupation in guide.in_demand_occupations %}
                    <span class="occupation-tag">{{ occupation }}</span>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Places to Explore (Provincial) -->
            {% if guide.places_to_explore %}
            <section class="content-section" id="places">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-geo-alt"></i></div>
                    <h2 class="section-title">Places to Explore</h2>
                </div>
                <div class="places-grid">
                    {% for place in guide.places_to_explore %}
                    <div class="place-card">
                        <div class="place-icon">{{ place.icon }}</div>
                        <div class="place-name">{{ place.name }}</div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Living Costs (Provincial) -->
            {% if guide.living_costs %}
            <section class="content-section" id="living-costs">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-currency-dollar"></i></div>
                    <h2 class="section-title">Cost of Living</h2>
                </div>
                <div class="costs-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Expense</th>
                                <th>Monthly Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for expense, cost in guide.living_costs.items() %}
                            <tr>
                                <td>{{ expense|replace('_', ' ')|title }}</td>
                                <td>{{ cost }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}

            <!-- Before You Start (Forms) -->
            {% if guide.before_you_start %}
            <section class="content-section" id="before-start">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-clipboard-check"></i></div>
                    <h2 class="section-title">Before You Start</h2>
                </div>
                <ul class="checklist">
                    {% for item in guide.before_you_start %}
                    <li>
                        <i class="bi bi-check-square"></i>
                        <span>{{ item }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}

            <!-- Form Sections (Forms) -->
            {% if guide.sections and guide.sections[0].section is defined %}
            <section class="content-section" id="form-sections">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-card-list"></i></div>
                    <h2 class="section-title">Form Sections</h2>
                </div>
                {% for section in guide.sections %}
                <div class="form-section-card">
                    <div class="form-section-name">
                        <i class="bi bi-file-earmark-text"></i>
                        {{ section.section }}
                    </div>
                    {% if section.fields %}
                    <div class="form-fields">
                        {% for field in section.fields %}
                        <span class="form-field">{{ field }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if section.what_to_include %}
                    <ul class="requirement-list mb-3">
                        {% for item in section.what_to_include %}
                        <li><i class="bi bi-dot"></i> {{ item }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% if section.tips %}
                    <div class="form-section-tip">
                        <i class="bi bi-lightbulb me-2"></i>{{ section.tips }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </section>
            {% endif %}

            <!-- Test Sections (Language Tests) -->
            {% if guide.sections and guide.sections[0].name is defined %}
            <section class="content-section" id="test-sections">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-journal-text"></i></div>
                    <h2 class="section-title">Test Sections</h2>
                </div>
                {% for section in guide.sections %}
                <div class="test-section-card">
                    <div class="test-section-header">
                        <span class="test-section-name">{{ section.name }}</span>
                        <span class="test-section-duration">{{ section.duration }}</span>
                    </div>
                    <div class="test-section-info">
                        {% if section.questions %}
                        <span><i class="bi bi-question-circle me-1"></i> {{ section.questions }}</span>
                        {% endif %}
                        {% if section.format %}
                        <span><i class="bi bi-file-text me-1"></i> {{ section.format }}</span>
                        {% endif %}
                    </div>
                    {% if section.tips %}
                    <ul class="test-section-tips">
                        {% for tip in section.tips %}
                        <li><i class="bi bi-check-circle"></i> {{ tip }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
                {% endfor %}
            </section>
            {% endif %}

            <!-- Advantages (CELPIP vs IELTS) -->
            {% if guide.advantages_over_ielts %}
            <section class="content-section" id="advantages">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-trophy"></i></div>
                    <h2 class="section-title">Advantages Over IELTS</h2>
                </div>
                <ul class="advantages-list">
                    {% for advantage in guide.advantages_over_ielts %}
                    <li>
                        <i class="bi bi-check-circle-fill"></i>
                        <span>{{ advantage }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}

            <!-- Academic vs General Comparison -->
            {% if guide.academic_vs_general %}
            <section class="content-section" id="comparison">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-arrow-left-right"></i></div>
                    <h2 class="section-title">Academic vs General Training</h2>
                </div>
                <div class="info-box mb-4">
                    <p>{{ guide.academic_vs_general.description }}</p>
                </div>
                <div class="costs-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Aspect</th>
                                <th>Academic</th>
                                <th>General Training</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if guide.academic_vs_general.reading %}
                            <tr>
                                <td><strong>Reading</strong></td>
                                <td>{{ guide.academic_vs_general.reading.academic }}</td>
                                <td>{{ guide.academic_vs_general.reading.general }}</td>
                            </tr>
                            {% endif %}
                            {% if guide.academic_vs_general.writing_task_1 %}
                            <tr>
                                <td><strong>Writing Task 1</strong></td>
                                <td>{{ guide.academic_vs_general.writing_task_1.academic }}</td>
                                <td>{{ guide.academic_vs_general.writing_task_1.general }}</td>
                            </tr>
                            {% endif %}
                            {% if guide.academic_vs_general.difficulty %}
                            <tr>
                                <td><strong>Difficulty</strong></td>
                                <td>{{ guide.academic_vs_general.difficulty.academic }}</td>
                                <td>{{ guide.academic_vs_general.difficulty.general }}</td>
                            </tr>
                            {% endif %}
                            {% if guide.academic_vs_general.scoring %}
                            <tr>
                                <td><strong>Scoring</strong></td>
                                <td>{{ guide.academic_vs_general.scoring.academic }}</td>
                                <td>{{ guide.academic_vs_general.scoring.general }}</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}

            <!-- When to Use -->
            {% if guide.when_to_use %}
            <section class="content-section" id="when-to-use">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-question-circle"></i></div>
                    <h2 class="section-title">When to Use This Test</h2>
                </div>
                <div class="row g-3">
                    {% for use_case, description in guide.when_to_use.items() %}
                    <div class="col-md-6">
                        <div class="program-card h-100">
                            <div class="program-name mb-2">{{ use_case|replace('_', ' ')|title }}</div>
                            <p class="program-desc mb-0">{{ description }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- University Requirements -->
            {% if guide.university_requirements %}
            <section class="content-section" id="university-requirements">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-mortarboard"></i></div>
                    <h2 class="section-title">University Score Requirements</h2>
                </div>
                <div class="row g-3">
                    {% for level, scores in guide.university_requirements.items() %}
                    <div class="col-md-4">
                        <div class="program-card h-100">
                            <div class="program-name mb-3">{{ level|replace('_', ' ')|title }}</div>
                            {% if scores is mapping %}
                            {% for score_type, score_value in scores.items() %}
                            <p class="mb-1"><strong style="color: {{ category.color }};">{{ score_type|title }}:</strong> {{ score_value }}</p>
                            {% endfor %}
                            {% else %}
                            <p class="program-desc mb-0">{{ scores }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Score Requirements by Program -->
            {% if guide.score_requirements_by_program %}
            <section class="content-section" id="program-scores">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-bar-chart"></i></div>
                    <h2 class="section-title">Score Requirements by Program</h2>
                </div>
                <div class="costs-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Program Type</th>
                                <th>Typical Score Required</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for req in guide.score_requirements_by_program %}
                            <tr>
                                <td>{{ req.program }}</td>
                                <td><strong>{{ req.typical_score }}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}

            <!-- Who to Include (Family Forms) -->
            {% if guide.who_to_include %}
            <section class="content-section" id="who-include">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-people"></i></div>
                    <h2 class="section-title">Who to Include</h2>
                </div>
                <ul class="checklist">
                    {% for person in guide.who_to_include %}
                    <li>
                        <i class="bi bi-person-check"></i>
                        <span>{{ person }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}

            <!-- Required Information (Forms) -->
            {% if guide.required_information %}
            <section class="content-section" id="required-info">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-card-checklist"></i></div>
                    <h2 class="section-title">Required Information</h2>
                </div>
                <ul class="checklist">
                    {% for info in guide.required_information %}
                    <li>
                        <i class="bi bi-file-earmark-check"></i>
                        <span>{{ info }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}

            <!-- Score Improvement (Language Tests) -->
            {% if guide.score_improvement %}
            <section class="content-section" id="score-improvement">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-arrow-up-circle"></i></div>
                    <h2 class="section-title">Score Improvement Strategies</h2>
                </div>
                {% for improvement in guide.score_improvement %}
                <div class="strategy-card">
                    <div class="strategy-header">
                        <span class="strategy-points">{{ improvement.from }} â†’ {{ improvement.to }}</span>
                        <span class="strategy-change">CRS: <span>{{ improvement.crs_gain }}</span></span>
                    </div>
                    <p class="strategy-text">{{ improvement.strategy }}</p>
                </div>
                {% endfor %}
            </section>
            {% endif %}

            <!-- CLB Conversion -->
            {% if guide.clb_conversion and guide.clb_conversion.keys()|list|length > 1 %}
            <section class="content-section" id="clb-conversion">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-table"></i></div>
                    <h2 class="section-title">CLB Score Conversion</h2>
                </div>
                <div class="clb-table">
                    <table>
                        <thead>
                            <tr>
                                <th>CLB Level</th>
                                <th>Listening</th>
                                <th>Reading</th>
                                <th>Writing</th>
                                <th>Speaking</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for level, scores in guide.clb_conversion.items() %}
                            {% if scores is mapping and scores.listening is defined %}
                            <tr>
                                <td class="clb-level">{{ level }}</td>
                                <td>{{ scores.listening }}</td>
                                <td>{{ scores.reading }}</td>
                                <td>{{ scores.writing }}</td>
                                <td>{{ scores.speaking }}</td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}

            <!-- Step by Step -->
            {% if guide.step_by_step %}
            <section class="content-section" id="steps">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-list-ol"></i></div>
                    <h2 class="section-title">Step-by-Step Process</h2>
                </div>
                <div class="steps-container">
                    {% for step in guide.step_by_step %}
                    <div class="step-item">
                        <div class="step-number">{{ step.step }}</div>
                        <div class="step-content">
                            <h4>{{ step.title }}</h4>
                            <p>{{ step.description }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Tips -->
            {% if guide.tips %}
            <section class="content-section" id="tips">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-lightbulb"></i></div>
                    <h2 class="section-title">Pro Tips</h2>
                </div>
                <ul class="tips-list">
                    {% for tip in guide.tips %}
                    <li>
                        <div class="tip-icon"><i class="bi bi-check"></i></div>
                        <span class="tip-text">{{ tip }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}

            <!-- Common Mistakes -->
            {% if guide.common_mistakes %}
            <section class="content-section" id="mistakes">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-exclamation-triangle"></i></div>
                    <h2 class="section-title">Common Mistakes to Avoid</h2>
                </div>
                <ul class="tips-list mistakes-list">
                    {% for mistake in guide.common_mistakes %}
                    <li>
                        <div class="tip-icon"><i class="bi bi-x"></i></div>
                        <span class="tip-text">{{ mistake }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}

            <!-- Costs Breakdown (Express Entry) -->
            {% if guide.costs_breakdown %}
            <section class="content-section" id="costs">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-currency-dollar"></i></div>
                    <h2 class="section-title">Application Costs</h2>
                </div>
                <div class="costs-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item, cost in guide.costs_breakdown.items() %}
                            <tr>
                                <td>{{ item|replace('_', ' ')|title }}</td>
                                <td><strong>{{ cost }}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}

            <!-- Resources -->
            {% if guide.resources %}
            <section class="content-section" id="resources">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-link-45deg"></i></div>
                    <h2 class="section-title">Official Resources</h2>
                </div>
                <div class="row g-3">
                    {% for resource in guide.resources %}
                    <div class="col-md-6">
                        <a href="{{ resource.url }}" target="_blank" class="resource-card">
                            <div class="resource-icon"><i class="bi bi-globe"></i></div>
                            <div>
                                <div class="resource-name">{{ resource.name }}</div>
                                <div class="resource-url">{{ resource.url|truncate(40) }}</div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="sidebar-card">
                <div class="sidebar-title">
                    <i class="bi bi-list-ul"></i>
                    On This Page
                </div>
                <ul class="toc-list">
                    {% if guide.key_facts %}<li><a href="#key-facts">Key Facts</a></li>{% endif %}
                    {% if guide.programs %}<li><a href="#programs">Immigration Programs</a></li>{% endif %}
                    {% if guide.crs_breakdown %}<li><a href="#crs-breakdown">CRS Breakdown</a></li>{% endif %}
                    {% if guide.improvement_strategies %}<li><a href="#improvement">CRS Improvement</a></li>{% endif %}
                    {% if guide.streams %}<li><a href="#streams">Immigration Streams</a></li>{% endif %}
                    {% if guide.in_demand_occupations %}<li><a href="#occupations">In-Demand Jobs</a></li>{% endif %}
                    {% if guide.places_to_explore %}<li><a href="#places">Places to Explore</a></li>{% endif %}
                    {% if guide.living_costs %}<li><a href="#living-costs">Cost of Living</a></li>{% endif %}
                    {% if guide.before_you_start %}<li><a href="#before-start">Before You Start</a></li>{% endif %}
                    {% if guide.sections and guide.sections[0].section is defined %}<li><a href="#form-sections">Form Sections</a></li>{% endif %}
                    {% if guide.sections and guide.sections[0].name is defined %}<li><a href="#test-sections">Test Sections</a></li>{% endif %}
                    {% if guide.advantages_over_ielts %}<li><a href="#advantages">Advantages</a></li>{% endif %}
                    {% if guide.academic_vs_general %}<li><a href="#comparison">Academic vs General</a></li>{% endif %}
                    {% if guide.when_to_use %}<li><a href="#when-to-use">When to Use</a></li>{% endif %}
                    {% if guide.university_requirements %}<li><a href="#university-requirements">University Requirements</a></li>{% endif %}
                    {% if guide.score_requirements_by_program %}<li><a href="#program-scores">Program Scores</a></li>{% endif %}
                    {% if guide.who_to_include %}<li><a href="#who-include">Who to Include</a></li>{% endif %}
                    {% if guide.required_information %}<li><a href="#required-info">Required Info</a></li>{% endif %}
                    {% if guide.score_improvement %}<li><a href="#score-improvement">Score Improvement</a></li>{% endif %}
                    {% if guide.clb_conversion %}<li><a href="#clb-conversion">CLB Conversion</a></li>{% endif %}
                    {% if guide.step_by_step %}<li><a href="#steps">Step-by-Step</a></li>{% endif %}
                    {% if guide.tips %}<li><a href="#tips">Pro Tips</a></li>{% endif %}
                    {% if guide.common_mistakes %}<li><a href="#mistakes">Common Mistakes</a></li>{% endif %}
                    {% if guide.costs_breakdown %}<li><a href="#costs">Application Costs</a></li>{% endif %}
                    {% if guide.resources %}<li><a href="#resources">Resources</a></li>{% endif %}
                </ul>
            </div>

            <div class="sidebar-card">
                <div class="sidebar-title">
                    <i class="bi bi-bookmark"></i>
                    Related Guides
                </div>
                <div class="d-grid gap-2">
                    <a href="/guides" class="btn btn-outline-light btn-sm">
                        <i class="bi bi-arrow-left me-2"></i>All Guides
                    </a>
                    <a href="/guides/{{ category.id }}" class="btn btn-outline-light btn-sm">
                        More {{ category.title }}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
