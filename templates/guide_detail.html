{% extends "base.html" %}

{% block title %}{{ guide.title }}{% endblock %}

{% block extra_css %}
<style>
    /* Breadcrumb */
    .breadcrumb-section {
        padding: 2rem 0;
        border-bottom: 1px solid var(--philata-border);
    }

    .breadcrumb {
        background: none;
        padding: 0;
        margin: 0;
    }

    .breadcrumb-item a {
        color: var(--philata-text-muted);
    }

    .breadcrumb-item.active {
        color: var(--philata-red-light);
    }

    .breadcrumb-item + .breadcrumb-item::before {
        color: var(--philata-text-muted);
    }

    /* Guide Header */
    .guide-header {
        padding: 4rem 0;
        position: relative;
        overflow: hidden;
    }

    .guide-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(ellipse at top left, {{ category.color }}22 0%, transparent 50%);
        pointer-events: none;
    }

    .guide-icon {
        font-size: 4rem;
        margin-bottom: 1.5rem;
        display: block;
    }

    .guide-title {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
    }

    .guide-subtitle {
        font-size: 1.25rem;
        color: var(--philata-text-muted);
        margin-bottom: 2rem;
    }

    .guide-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--philata-text-muted);
    }

    .meta-item i {
        color: {{ category.color }};
    }

    /* Content Sections */
    .content-section {
        padding: 3rem 0;
        border-bottom: 1px solid var(--philata-border);
    }

    .content-section:last-child {
        border-bottom: none;
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .section-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: {{ category.color }}22;
        display: flex;
        align-items: center;
        justify-content: center;
        color: {{ category.color }};
        font-size: 1.25rem;
    }

    .section-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: white;
        margin: 0;
    }

    /* Key Facts Grid */
    .facts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }

    .fact-card {
        background: rgba(255,255,255,0.03);
        border: 1px solid var(--philata-border);
        border-radius: 16px;
        padding: 1.5rem;
        transition: all 0.3s ease;
    }

    .fact-card:hover {
        background: rgba(255,255,255,0.05);
        transform: translateY(-3px);
    }

    .fact-label {
        font-size: 0.8rem;
        color: var(--philata-text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 0.5rem;
    }

    .fact-value {
        font-size: 1.1rem;
        font-weight: 600;
        color: white;
    }

    /* CLB Table */
    .clb-table {
        background: rgba(255,255,255,0.02);
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid var(--philata-border);
    }

    .clb-table table {
        width: 100%;
        margin: 0;
    }

    .clb-table th {
        background: rgba(255,255,255,0.05);
        padding: 1rem;
        font-weight: 600;
        color: white;
        text-align: center;
        border-bottom: 1px solid var(--philata-border);
    }

    .clb-table td {
        padding: 1rem;
        text-align: center;
        color: var(--philata-text);
        border-bottom: 1px solid var(--philata-border);
    }

    .clb-table tr:last-child td {
        border-bottom: none;
    }

    .clb-table tr:hover td {
        background: rgba(255,255,255,0.02);
    }

    .clb-level {
        font-weight: 700;
        color: {{ category.color }};
    }

    /* Tips List */
    .tips-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .tips-list li {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid var(--philata-border);
    }

    .tips-list li:last-child {
        border-bottom: none;
    }

    .tip-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        flex-shrink: 0;
    }

    .tip-text {
        color: var(--philata-text);
        line-height: 1.6;
    }

    /* Mistakes List */
    .mistakes-list li .tip-icon {
        background: linear-gradient(135deg, #EF4444 0%, #F87171 100%);
    }

    /* Step by Step */
    .steps-container {
        position: relative;
    }

    .steps-container::before {
        content: '';
        position: absolute;
        left: 24px;
        top: 40px;
        bottom: 40px;
        width: 2px;
        background: var(--philata-border);
    }

    .step-item {
        display: flex;
        gap: 1.5rem;
        padding: 1.5rem 0;
        position: relative;
    }

    .step-number {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: {{ category.color }};
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.25rem;
        color: white;
        flex-shrink: 0;
        position: relative;
        z-index: 1;
    }

    .step-content h4 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .step-content p {
        color: var(--philata-text-muted);
        margin: 0;
    }

    /* Resources */
    .resource-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1.25rem;
        background: rgba(255,255,255,0.03);
        border: 1px solid var(--philata-border);
        border-radius: 12px;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .resource-card:hover {
        background: rgba(255,255,255,0.06);
        border-color: {{ category.color }};
        transform: translateX(5px);
    }

    .resource-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: {{ category.color }}22;
        display: flex;
        align-items: center;
        justify-content: center;
        color: {{ category.color }};
    }

    .resource-name {
        font-weight: 600;
        color: white;
    }

    .resource-url {
        font-size: 0.85rem;
        color: var(--philata-text-muted);
    }

    /* Sidebar */
    .sidebar-card {
        background: rgba(255,255,255,0.03);
        border: 1px solid var(--philata-border);
        border-radius: 20px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        position: sticky;
        top: 100px;
    }

    .sidebar-title {
        font-size: 1rem;
        font-weight: 600;
        color: white;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .toc-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .toc-list a {
        display: block;
        padding: 0.5rem 0;
        color: var(--philata-text-muted);
        font-size: 0.9rem;
        border-left: 2px solid transparent;
        padding-left: 1rem;
        transition: all 0.3s ease;
    }

    .toc-list a:hover, .toc-list a.active {
        color: {{ category.color }};
        border-left-color: {{ category.color }};
    }

    /* Animations */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .animate-in {
        animation: fadeInUp 0.6s ease forwards;
    }

    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
    .delay-3 { animation-delay: 0.3s; }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<section class="breadcrumb-section">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/guides">Guides</a></li>
                <li class="breadcrumb-item"><a href="/guides/{{ category.id }}">{{ category.title }}</a></li>
                <li class="breadcrumb-item active">{{ guide.title }}</li>
            </ol>
        </nav>
    </div>
</section>

<!-- Guide Header -->
<section class="guide-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <span class="guide-icon animate-in">{{ guide.icon }}</span>
                <h1 class="guide-title animate-in delay-1">{{ guide.title }}</h1>
                <p class="guide-subtitle animate-in delay-2">{{ guide.subtitle }}</p>

                <div class="guide-meta animate-in delay-3">
                    {% if guide.difficulty %}
                    <div class="meta-item">
                        <i class="bi bi-bar-chart"></i>
                        <span>{{ guide.difficulty }}</span>
                    </div>
                    {% endif %}
                    {% if guide.duration %}
                    <div class="meta-item">
                        <i class="bi bi-clock"></i>
                        <span>{{ guide.duration }}</span>
                    </div>
                    {% endif %}
                </div>

                <p class="text-muted">{{ guide.overview }}</p>
            </div>
        </div>
    </div>
</section>

<div class="container">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Key Facts -->
            {% if guide.key_facts %}
            <section class="content-section" id="key-facts">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-info-circle"></i></div>
                    <h2 class="section-title">Key Facts</h2>
                </div>
                <div class="facts-grid">
                    {% for key, value in guide.key_facts.items() %}
                    {% if value is string or value is number %}
                    <div class="fact-card">
                        <div class="fact-label">{{ key|replace('_', ' ')|title }}</div>
                        <div class="fact-value">{{ value }}</div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- CLB Conversion -->
            {% if guide.clb_conversion and guide.clb_conversion.keys()|list|length > 1 %}
            <section class="content-section" id="clb-conversion">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-table"></i></div>
                    <h2 class="section-title">CLB Score Conversion</h2>
                </div>
                <div class="clb-table">
                    <table>
                        <thead>
                            <tr>
                                <th>CLB Level</th>
                                <th>Listening</th>
                                <th>Reading</th>
                                <th>Writing</th>
                                <th>Speaking</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for level, scores in guide.clb_conversion.items() %}
                            {% if scores is mapping %}
                            <tr>
                                <td class="clb-level">{{ level }}</td>
                                <td>{{ scores.listening }}</td>
                                <td>{{ scores.reading }}</td>
                                <td>{{ scores.writing }}</td>
                                <td>{{ scores.speaking }}</td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}

            <!-- Step by Step -->
            {% if guide.step_by_step %}
            <section class="content-section" id="steps">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-list-ol"></i></div>
                    <h2 class="section-title">Step-by-Step Process</h2>
                </div>
                <div class="steps-container">
                    {% for step in guide.step_by_step %}
                    <div class="step-item">
                        <div class="step-number">{{ step.step }}</div>
                        <div class="step-content">
                            <h4>{{ step.title }}</h4>
                            <p>{{ step.description }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Tips -->
            {% if guide.tips %}
            <section class="content-section" id="tips">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-lightbulb"></i></div>
                    <h2 class="section-title">Pro Tips</h2>
                </div>
                <ul class="tips-list">
                    {% for tip in guide.tips %}
                    <li>
                        <div class="tip-icon"><i class="bi bi-check"></i></div>
                        <span class="tip-text">{{ tip }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}

            <!-- Common Mistakes -->
            {% if guide.common_mistakes %}
            <section class="content-section" id="mistakes">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-exclamation-triangle"></i></div>
                    <h2 class="section-title">Common Mistakes to Avoid</h2>
                </div>
                <ul class="tips-list mistakes-list">
                    {% for mistake in guide.common_mistakes %}
                    <li>
                        <div class="tip-icon"><i class="bi bi-x"></i></div>
                        <span class="tip-text">{{ mistake }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}

            <!-- Resources -->
            {% if guide.resources %}
            <section class="content-section" id="resources">
                <div class="section-header">
                    <div class="section-icon"><i class="bi bi-link-45deg"></i></div>
                    <h2 class="section-title">Official Resources</h2>
                </div>
                <div class="row g-3">
                    {% for resource in guide.resources %}
                    <div class="col-md-6">
                        <a href="{{ resource.url }}" target="_blank" class="resource-card">
                            <div class="resource-icon"><i class="bi bi-globe"></i></div>
                            <div>
                                <div class="resource-name">{{ resource.name }}</div>
                                <div class="resource-url">{{ resource.url|truncate(40) }}</div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="sidebar-card">
                <div class="sidebar-title">
                    <i class="bi bi-list-ul"></i>
                    On This Page
                </div>
                <ul class="toc-list">
                    {% if guide.key_facts %}<li><a href="#key-facts">Key Facts</a></li>{% endif %}
                    {% if guide.clb_conversion %}<li><a href="#clb-conversion">CLB Conversion</a></li>{% endif %}
                    {% if guide.step_by_step %}<li><a href="#steps">Step-by-Step</a></li>{% endif %}
                    {% if guide.tips %}<li><a href="#tips">Pro Tips</a></li>{% endif %}
                    {% if guide.common_mistakes %}<li><a href="#mistakes">Common Mistakes</a></li>{% endif %}
                    {% if guide.resources %}<li><a href="#resources">Resources</a></li>{% endif %}
                </ul>
            </div>

            <div class="sidebar-card">
                <div class="sidebar-title">
                    <i class="bi bi-bookmark"></i>
                    Related Guides
                </div>
                <div class="d-grid gap-2">
                    <a href="/guides" class="btn btn-outline-light btn-sm">
                        <i class="bi bi-arrow-left me-2"></i>All Guides
                    </a>
                    <a href="/guides/{{ category.id }}" class="btn btn-outline-light btn-sm">
                        More {{ category.title }}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
